<!DOCTYPE html>
<!-- 
	출입국 외국인청 활용모델
	코드 정리 필요
  -->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>SW상호운용성 실증모델</title>  
<script src="https://cesium.com/downloads/cesiumjs/releases/1.95/Build/Cesium/Cesium.js"></script>
<link href="https://cesium.com/downloads/cesiumjs/releases/1.95/Build/Cesium/Widgets/widgets.css" rel="stylesheet">
<link rel="stylesheet" href="css/common.css">
<link rel="stylesheet" href="css/ztreeStyle.css">
<link rel="stylesheet" href="css/jquery.scrollbar.css"/>


<script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.4.4/proj4.js"></script>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script type='text/javascript' src='js/jquery.ztree.core.js'></script>
<script type='text/javascript' src='js/jquery.ztree.excheck.js'></script>
<script type='text/javascript' src='js/jquery.ztree.exedit.js'></script>
<script type='text/javascript' src='js/jquery.scrollbar.min.js'></script>
<!-- <script type='text/javascript' src='js/dosidong.js'></script>
<script type='text/javascript' src='js/cluster.js'></script>
<script type='text/javascript' src='js/route.js'></script>-->
<script type='text/javascript' src='js/search.js'></script>
<script type='text/javascript' src='js/ztree.js'></script> 
<!--
https://openlayers.org/en/v6.4.3/build/ol.js
https://openlayers.org/en/v5.3.0/build/ol.js
https://openlayers.org/en/v4.6.5/build/ol.js
https://openlayers.org/en/v3.20.1/build/ol.js

https://openlayers.org/en/v6.4.3/css/ol.css
https://openlayers.org/en/v5.3.0/css/ol.css
https://openlayers.org/en/v4.6.5/css/ol.css
https://openlayers.org/en/v3.20.1/css/ol.css
-->

<script>

</script>

</head>

<body>
<div id="wrap">
    <div id="cesiumContainer" style="width: 100%; ; left: 0px; top: 0px"></div>
    <div class="main-rr-menus">
        <a href="#" class="main-r-menu mr001"></a>
        <a href="javascript:clear();" class="main-r-menu mr002">지도<br>초기화</a>
        <a href="#" class="main-r-menu mr003" style="display: none;"></a>
        <a href="#" class="main-r-menu mr004" style="display: none;"></a>
        <a href="#" class="main-r-menu mr005" style="display: none;"></a>
        <a href="#" class="main-r-menu mr006"style="display: none;"></a>
        <a href="#" class="main-r-menu mr007 active" style="display: none;"></a>
        <a id="image-download" download="map.png"></a>
    </div>
    <div id="lnb">
        <ul>
            <li>
                <a href="#" class="lnb001" name="layer" title="레이어 목록">레이어<br>목록</a>
            </li>
            <li onclick="$('[name=query]').val('');$('[name=type]').val('PLACE');$('[name=category]').val('')" >
                <a href="#" class="lnb002" name="search" title="주소검색">주소<br>검색</a>
            </li>
            <li>
                <a href="#" class="lnb003" name="fac" title="구역통계">구역<br>통계</a>
            </li>
            <li>
                <a href="#" class="lnb004" name="mng" title="영역조회">영역<br>조회</a>
            </li>
            <li>
                <a href="#" class="lnb005" name="type" title="경로검색">경로<br>검색</a>
            </li>
        </ul>
        <div id="lnbmenu1" class="sbmenu">
            <div class="title">레이어 목록</div>
            <div class="bd">
                <div class="scrollDv ls3t">
                    <div class="scrollbar-inner">
                        <div class="subtitle" >
                            <span class="span">배경지도</span>
                            <select name="baseMapLayer" id="baseMapLayer" title="배경지도종류" class="form-control" >
                                <option value="Satellite">영상지도</option>
                                <option value="Base">기본지도</option>
                                <option value="gray">회색지도</option>
                                <option value="midnight">야간지도</option>
                                <option value="Hybrid">영상POI</option>
                            </select>
                        </div>
                        <div class="range-list">
                            <ul id="range-ul">
                            </ul>
                            
                        </div>
                        <ul id="tree1" class="ztree" style="margin-top: 1px;"></ul>
                    </div>
                </div>
               
            </div>
        </div>

        <div id="lnbmenu2" class="sbmenu">
            <div class="title">주소검색</div>
            <div class="bd">
                <div class="search_wrap">
                    <label for="lnb2_search">검색어</label>
                    <form id="searchForm" action="#" class="form_data" onsubmit="return false;search();">
                        <input type="hidden" name="page" value="1" />
                        <input type="hidden" name="type" value="PLACE" />
                        <input type="hidden" name="category" value="" />
                        <input type="hidden" name="size" value="1000" />
                        <input type="hidden" name="request" value="search" />
                        <input type="hidden" name="apiKey" value="CEB52025-E065-364C-9DBA-44880E3B02B8" />
                        <input type="text" id="searchValue" name="query" placeholder="검색어를 입력하세요">
                    </form>
                    <a href="javascript:search();" class="btn btn_prm_new s_btn" >조회</a>
                </div>
                <div class="tab_wrap">
                    <a href="javascript:$('[name=type]').val('PLACE');$('[name=category]').val('');search();" class="tab2 tab2_001 on">명칭</a>
                    <a href="javascript:$('[name=type]').val('address');$('[name=category]').val('road');search();" class="tab2 tab2_002" >도로명</a>
                    <a href="javascript:$('[name=type]').val('address');$('[name=category]').val('parcel');search();" class="tab2 tab2_003" >지번</a>
                </div>
                <ul class="search_result" id="search_result">
                    <li>
                        <a href="#" >검색결과가 없습니다.</a>
                    </li>
                </ul>
            </div>
        </div>
        <div id="lnbmenu3" class="sbmenu">
            <div class="title">행정구역</div>
            <div class="bd2">
                <select id="sido_code">
                    <option>선택</option>
                </select>
                <select id="sigoon_code">
                    <option>선택</option>
                </select>
                <select id="dong_code">
                    <option>선택</option>
                </select>
                <select id="lee_code">
                    <option>선택</option>
                </select>
            </div>
            <div class="bd">
                <ul class="search_result" id="code_result">
                    
                </ul>
            </div>
        </div>

        <div id="lnbmenu4" class="sbmenu">
            <div class="title">영역 조회</div>
            <div class="bd">
                <div class="scrollDv">
                    <div class="scrollbar-inner">
                        <div class="subtitle" >
                            <span class="span">레이어</span>
                            <select name="baseMapLayer" id="baseMapLayer" title="배경지도종류" class="form-control" >
                                <option value="Base">기본지도</option>
                                <option value="gray">회색지도</option>
                                <option value="midnight">야간지도</option>
                                <option value="Satellite">영상지도</option>
                                <option value="Hybrid">영상POI</option>
                            </select>
                        </div>
                        <ul id="tree1" class="ztree" style="margin-top: 13px;"></ul>
                    </div>
                </div>
            </div>
        </div>

        <div id="lnbmenu5" class="sbmenu">
            <div class="title">경로검색</div>
            <div class="bd">
                <ul class="search_result" id="route_result">
                    <li><a href="javascript:route('1동')" >1동</a></li>
                    <li><a href="javascript:route('2동')" >2동</a></li>
                    <li><a href="javascript:route('3동')" >3동</a></li>
                    <li><a href="javascript:route('4동')" >4동</a></li>
                    <li><a href="javascript:route('5동')" >5동</a></li>
                    <li><a href="javascript:route('6동')" >6동</a></li>
                    <li><a href="javascript:route('7동')" >7동</a></li>
                    <li><a href="javascript:route('8동')" >8동</a></li>
                    <li><a href="javascript:route('9동')" >9동</a></li>
                    <li><a href="javascript:route('10동')" >10동</a></li>
                </ul>
                <div class="search_wrap">
                </div>
                <div>
                    <div>상세결과</div>
                    <ul class="search_result" id="route_detail_result">

                    </ul>
                </div>
                
            </div>
        </div>
    </div><!--//lnb  -->
</div>

<script type="text/javascript">
/*
knockout 세슘 제공 MVVM  https://github.com/knockout/knockout   https://knockoutjs.com/examples/helloWorld.html  data-bind 

*/
    $("#lnb > ul > li > a").on("click",function () {
        var idx = $("#lnb > ul > li > a").index(this);
        var num = parseInt(idx + 1);
        chnav = $(this).parent();
        shownav = $(this).attr("href");
        //$("#fromDt").datepicker("destroy");

        if (chnav.hasClass("active")) {
        chnav.removeClass("active")
        $("#lnb > ul > li > ul").removeClass("on")
        $("#lnb").find(".sbmenu").removeClass("active")
        //$("#lnbmenu"+num).removeClass("active")
        $(".lyrpop").dialog("close");

        } else {
        $("#lnb > ul > li").removeClass("active")
        $("#lnb").find(".sbmenu").removeClass("active")
        chnav.addClass("active")
        //$("#lnb").find(shownav).addClass("active");
        $("#lnbmenu" + num).addClass("active");

        }
    });

    $(".tab_wrap > .tab2").on("click",function () {
        $(".tab_wrap > .tab2").removeClass('on')
        $(this).addClass('on');
    });

    var initCall = function(){ 
    $.ajax({
		type : "get",
		url : '/json/layerTree3D.json' ,
		
		dataType : 'json',
		async : false,
		//jsonpCallback:"parseResponse",
		success : function(data) {
       
            console.log(data);

		},
		error : function(xhr, stat, err) {
		}
	});
}   
initCall();

Cesium.Ion.defaultAccessToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiIzNjYyMzk1MC1lYjUyLTQ0NWMtYjUxMS02YTE1ZjJmZTY5M2UiLCJpZCI6Nzk1NiwiaWF0IjoxNjMyODAxMTEyfQ._gCt7u-pr1dKByvZshBO3zC-sulLwYQCoF-khAflgqU';

// Initialize the Cesium Viewer in the HTML element with the `cesiumContainer` ID.
const viewer = new Cesium.Viewer('cesiumContainer', {
    terrainProvider: Cesium.createWorldTerrain()
}); 
var imageryLayers = viewer.imageryLayers;
imageryLayers.get(0).name="bing"
updateLayerList()
const baseLayers = viewModel.baseLayers;

//viewer.scene.useWebVR = true; //vr 추가 옵션  stereoscopic 

viewer.scene.globe.depthTestAgainstTerrain = true;

var tileset = new Cesium.Cesium3DTileset({
  url: "https://xdworld.vworld.kr/TDServer/services/facility_LOD4/Gyeonggi-do/Seongnam-si/tileset.json",
});

// Add a WMS imagery layer 국가공간정보포털 레이어



// tileset.readyPromise
//     .then(function (tileset) {
//     viewer.scene.primitives.add(tileset);
//     viewer.zoomTo(
//         tileset,
//         new Cesium.HeadingPitchRange(
//         0.0,
//         -0.5,
//         tileset.boundingSphere.radius * 2.0
//         )
//     );
// });

//세슘 OSM 빌딩
viewer.scene.primitives.add(Cesium.createOsmBuildings());

var moveCesium = function(x,y,z,h,p){
    viewer.camera.setView({
        destination: Cesium.Cartesian3.fromDegrees(x,y,z),
        orientation: {
            heading: Cesium.Math.toRadians(h),
            pitch: Cesium.Math.toRadians(p),
            roll: 0.0,
        },
    });
}

var flyCesium = function(x,y,z,h,p){
    viewer.scene.camera.flyTo({
        destination: Cesium.Cartesian3.fromDegrees(x,y,z),
        orientation: {
            heading: Cesium.Math.toRadians(h),
            pitch: Cesium.Math.toRadians(p),
            roll: 0.0,
        },
    });
}
 
moveCesium(126.9142,37.53185,788, 351.73879531709434,-88.59244966360814)

//최초 지도 호출
addAdditionalLayerOption(
  'baseTile',
  new Cesium.WebMapTileServiceImageryProvider({
    url : 'https://api.vworld.kr/req/wmts/1.0.0/CEB52025-E065-364C-9DBA-44880E3B02B8/Satellite/{TileMatrix}/{TileRow}/{TileCol}.jpeg',
    layer : 'Satellite',
    style : 'default',
    format : 'image/jpeg',
   tileMatrixSetID : '',
    maximumLevel: 19
 }),
  1.0,
  true
);
updateLayerList()

</script>
</body>
</html>
